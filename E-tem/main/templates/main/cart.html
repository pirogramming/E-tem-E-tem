{% extends 'base.html' %}
{% block content %}

    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Lemonada:wght@700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Song+Myung&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Gothic+A1:wght@500;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
              integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"
              crossorigin="anonymous">
    </head>
    <style>  /*Checkbox*/
    .card {
        position: relative;
    }

    a > .Check-Box {
        position: absolute;
        top: 10%;
        right: 3%;
    }


    /*img {*/
    /*    filter: blur(5px);*/
    /*}*/</style>

    <div style="height: 20%"></div>
    <div class="album py-5 bg-light">

        <div class="album py-5 bg-light">

            <div class="control All-checked">
                <p>전체 선택<input type="checkbox" id="All-checked"/></p>
                <button type="button" id="del_target">선택 삭제</button>
                <button type="button" id="download_target" onclick="javascript:download_selected()">선택 다운</button>
            </div>

            <div class="container">
                <div class="row">
                    {% for ppt in cart_items %}
                        <div class="col-md-4">
                            <div class="card mb-4 shadow-sm">
                                <a href={{ ppt.template.detail_page }} target="_blank">
                                    <img id="img" src={{ ppt.template.img_src }} height="200" width="350"
                                         style="align-items: center">
                                    <input type="checkbox" class="Check-Box" name="cart_checkbox"
                                           value={{ ppt.template.download_link }} id={{ ppt.template.id }}
                                    data-name="{{ ppt.template.download_link }}" style="transform: scale(5); "/>
                                    <a href="{% url 'cart_item_delete' ppt.template_id %}">
                                        <button type="button" class="Delete-Box"
                                                onclick="javascript:one_delete_success()">X
                                        </button>
                                    </a>
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div style="height: 40%"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <script>
        function one_delete_success() {
            alert('템플릿 삭제.')
        }
    </script>

<script>
        $('#All-checked').click(function () {
            if
            ($("input:checkbox[id='All-checked']").prop("checked")) {
                $("input[type=checkbox]").prop("checked", true);
            } else {
                $("input[type=checkbox]").prop("checked", false);
            }
        });
    </script>

    <script>

        $('#del_target').click(function () {
            const multi_delete_list = [];
            var size = document.getElementsByClassName("Check-Box").length;
            console.log(size)

            for (var i = 0; i < size; i++) {
                if (document.getElementsByClassName("Check-Box")[i].checked == true) {
                    console.log(document.getElementsByClassName("Check-Box")[i].id)
                    multi_delete_list.push(document.getElementsByClassName("Check-Box")[i].id)
                }
            }
            console.log(multi_delete_list)
            for (var i = 0; i < multi_delete_list.length; i++) {
                (function (i) {
                    $.ajax({
                        type: 'GET',
                        url: `/remove/` + multi_delete_list[i],
                        dataType: "json",
                        async: false,
                        success: function (result) {
                            location.href = "{% url 'cart' %}";
                        },
                    });
                })(i);
            }
        });
    </script>

    <script>
    function sleep (delay) {
            var start = new Date().getTime();
            while (new Date().getTime() < start + delay);
        }

    function download_selected (){
            const check_count = document.getElementsByName("cart_checkbox").length;
            console.log(check_count)
            for (var i=0; i< check_count; i++) {
                console.log('success')
                if (document.getElementsByName("cart_checkbox")[i].checked === true) {
                    console.log(document.getElementsByName("cart_checkbox")[i].checked)
                    location.href = document.getElementsByName("cart_checkbox")[i].getAttribute('data-name')
                    sleep(1000);
                }
                }
            };

    </script>

{% endblock %}