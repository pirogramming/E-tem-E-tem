{% extends 'base.html' %}


{% block head_show %}
<main role="main">

    <section class="jumbotron text-center">

        <div class="container">
            <h1> E-tem E-tem </h1>
            <p class="lead">안녕하세요. 저희는 남이 만든 템플릿을 무단으로 가져와서 팀 프로젝트 꿀 빠려고 하는 엣헴엣헴 입니다.
                팀 이름은 펭수의 유행어를 무단으로 가져왔습니다. 전체적인 프론트는 부트스트랩 사이트에서 무단으로 가져와 사용중입니다. 후원 부탁드립니다.</p>
            <p>
                <a href="#" class="btn btn-primary my-2">기프티콘 전송</a>
                <a href="#" class="btn btn-secondary my-2">입금 하기</a>
            </p>
        </div>
    </section>
    <!--여기까지 상단 부분-->
</main>
{% endblock %}


{% block content %}
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <style>
                a {
                    text-decoration: none;
                    color: #6c757d;
                }
    </style>
</head>

<body>
<main role="main">
    {% if not user.is_authenticated %}
    <div class="d-flex justify-content-center before_login">
        <button type="button" class="btn btn-lg btn-outline-danger">
            <a href="{% url 'loginhome' %}"> 이용하려면 로그인 해주세요 엣-헴! </a>
        </button>
    </div>
    {% endif %}

    {% for color in colorset %}
        <a href="{% url 'color' color.id %}">{{ color.color }}</a>
    {% endfor %}



    <div class="album py-5 bg-light">

        <div class="album py-5 bg-light">
            <div class="container">
                <div class="row">
                    {% for ppt in template_list %}
                    <div class="col-md-4">
                        <div class="card mb-4 shadow-sm">
                            <a href="{{ ppt.detail_page }}" target="_blank">
                                <img src={{ ppt.img_src }} height="200" width="350" style="align-items: center">
                            </a>
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary">
                                    <a data-id="{{ ppt.id }}" class="add_to_cart">장바구니 담기</a>
                                </button>
                                <!--                            <form action="/count/{{ppt.id}}/" method="post">-->
                                <!--                                {% csrf_token %}-->
                                <button type="button" class="btn btn-sm btn-outline-secondary">
                                    <a href="{% url 'add_one_to_download_list' ppt.id %}" name="download">개별 다운로드</a>
                                </button>
                                <!--                            </form>-->
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="pagination ">
                    <span class="d-flex ">
                        {% if template_list.has_previous %}
                            <li class="page-item "><a href="?page=1" class="page-link">&laquo; 첫 페이지</a></li>
                        {% endif %}

                        {% if template_list.number > 5 %}
                            <li class="page-item "><a href="?page={{ previous_block }}" class="page-link">이전</a></li>
                        {% endif %}

                        {% for i in p_range %}
                            {% if template_list.number == i %}
                                <li class="page-item active"><a href="?page={{ i }}" class="page-link">{{ i }}</a></li>
                            {% else %}
                                <li class="page-item "><a href="?page={{ i }}" class="page-link">{{ i }}</a></li>
                            {% endif %}
                        {% endfor %}

                        {% if template_list.number < template_list.paginator.num_pages %}
                            <li class="page-item "><a href="?page={{ next_block }}" class="page-link">다음</a></li>
                        {% endif %}
                        {% if template_list.has_next %}
                            <li class="page-item "><a href="?page={{ template_list.paginator.num_pages }}" class="page-link">마지막 페이지 &raquo;</a></li>
                        {% endif %}

                    </span>
                </div>
            </div>
        </div>
    </div>

</main>

</body>

<!--여기에 ajax로 장바구니 담기-->
<script>

    $(document).ready(function () {
            $('.add_to_cart').on('click', function () {
                const templateId = $(this).attr('data-id')
                $.ajax({
                    type: 'GET',
                    url: `/add/${templateId}`,
                    data: templateId,
                    dataType: "json",
                    success: function (response) {
                        alert("담겼습니다.");
                        $("#carticon").html(response.quantity+"개");
                    }
                })
            });

            $(window).scroll(function ()
            {
                $('#cartscroll').animate({top:$(window).scrollTop()+"px"},{queue:false, duration:100});
            });

        });

</script>
{% endblock %}